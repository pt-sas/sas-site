function Destroy(e){let t=SITE_URL+DELETE+e;Swal.fire({title:"Delete?",text:"Are you sure you wish to delete the selected data ? ",type:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Ok",cancelButtonText:"Close"}).then(e=>{e.value&&$.post(t,function(e){reloadTable()}).fail(function(e,t,a){console.info(a),reloadTable()})})}function arrContains(e,t){var a=null;for(let o=0;o<t.length;o++){var l=t[o];if(l.toString().toLowerCase()===e.toString().toLowerCase()){a=l;break}}return a}function errorForm(e,t){const a=e.find('input[type="text"], textarea'),l=e.find("small");var o=[],n=[];for(let e=0;e<l.length;e++)""!==l[e].id&&n.push(l[e].id);for(let e=0;e<a.length;e++)o.push(a[e].name);for(let a=0;a<t.length;a++){var i=t[a].error,s=t[a].field,r=t[a].label,c=arrContains(i,n),m=arrContains(s,o);""!==r?(e.find("small[id="+c+"]").html(r),e.find("input:text[name="+m+"], textarea[name="+m+"]").addClass("is-invalid")):(e.find("small[id="+c+"]").html(""),e.find("input:text[name="+m+"], textarea[name="+m+"]").removeClass("is-invalid"))}}function clearForm(e){const t=e.find("input, textarea, select"),a=e.find("small");e[0].reset();for(let a=0;a<t.length;a++)e.find("input:text[name="+t[a].name+"], textarea[name="+t[a].name+"]").removeAttr("readonly").removeClass("is-invalid"),e.find("input:checkbox[name="+t[a].name+"]").removeAttr("disabled"),e.find("select[name="+t[a].name+"]").removeAttr("disabled").val(null).change();for(let t=0;t<a.length;t++)""!==a[t].id&&e.find("small[id="+a[t].id+"]").html("")}function readonly(e,t){const a=e.find("input, textarea, select");for(let l=0;l<a.length;l++){let o=a[l].className.split(/\s+/)[1];e.find("input:text[name="+a[l].name+"], textarea[name="+a[l].name+"]").prop("readonly",t),"text"!==a[l].type&&"active"!==o&&e.find("input:checkbox[name="+a[l].name+"], select[name="+a[l].name+"]").prop("disabled",t)}}function reloadTable(){_table.ajax.reload(null,!1)}function openModalForm(){return modalForm.modal({backdrop:"static",keyboard:!1})}function Scrollmodal(){return modalDialog.addClass("modal-dialog-scrollable")}function Largemodal(){return modalDialog.addClass("modal-lg")}function Smallmodal(){return modalDialog.addClass("modal-sm")}const ADMIN="/admin/";var ID,setSave,ORI_URL=window.location.origin,SITE_URL=window.location.href,LAST_URL=SITE_URL.substr(SITE_URL.lastIndexOf("/")+1),ADMIN_URL=ORI_URL+ADMIN;const SHOWALL="/showAll",CREATE="/create",SHOW="/show/",EDIT="/edit",DELETE="/destroy/",mainPage=$(".main_page"),formPage=$(".form_page"),cardTitle=$(".card-title"),modalForm=$(".modal_form"),modalDialog=$(".modal-dialog"),modalTitle=$(".modal-title"),modalBody=$(".modal-body");_table=$(".tb_display").DataTable({ajax:SITE_URL+SHOWALL,processing:!0,language:{processing:'<i class="fas fa-spinner fa-spin fa-1x fa-fw"></i><span> Processing...</span>'},columnDefs:[{targets:-1,orderable:!1},{targets:0,visible:!1}],autoWidth:!0,scrollX:!0}),$(".new_form").click(function(e){const t=$(e.target).closest(".row"),a=t.find(".card").prop("classList"),l=t.find("button").prop("classList");let o,n;for(let e=0;e<a.length;e++)if("main_page"===a[e].toLowerCase())mainPage.hide(),formPage.css("display","block"),o=formPage.closest(".form"),n=o.find('input[type="checkbox"].active'),cardTitle.html("New "+capitalize(LAST_URL));else{openModalForm(),Scrollmodal();for(let e=0;e<l.length;e++)"modal-lg"===l[e]?Largemodal():"modal-sm"===l[e]&&Smallmodal();o=modalForm.closest(".form"),n=o.find('input[type="checkbox"].active'),modalTitle.html("New "+capitalize(LAST_URL))}n.prop("checked",!0),setSave="add"}),$(".save_form").click(function(e){const t=$(e.target).closest(".form"),a=t.find("form"),l=t.prop("classList");let o,n;const i=a.find('input[type="checkbox"], select');for(let e=0;e<i.length;e++)a.find("input:checkbox[name="+i[e].name+"], select[name="+i[e].name+"]").removeAttr("disabled");"add"===setSave?(o=a.serialize(),n=SITE_URL+CREATE):(o=a.serialize()+"&id="+ID,n=SITE_URL+EDIT),$.ajax({url:n,type:"POST",data:o,dataType:"JSON",success:function(e){for(let t=0;t<l.length;t++)1==e[0].success?(Toast.fire({type:"success",title:e[0].message}),clearForm(a),"modal_form"!==l[t].toLowerCase()?(mainPage.show(),formPage.css("display","none")):modalForm.modal("hide"),reloadTable()):1==e[0].error?errorForm(a,e):Toast.fire({type:"error",title:e[0].message})}});for(let e=0;e<i.length;e++){let t=i[e].className.split(/\s+/)[1];"active"!==t&&($(".active").is(":checked")?a.find("input:checkbox[name="+i[e].name+"], select[name="+i[e].name+"]").removeAttr("disabled"):a.find("input:checkbox[name="+i[e].name+"], select[name="+i[e].name+"]").prop("disabled",!0))}}),_table.on("click","td:not(:last-child)",function(e){e.preventDefault();const t=$(e.target).closest(".card"),a=t.prop("classList"),l=t.find("button").prop("classList");let o,n;ID=_table.row(this).data()[0];for(let e=0;e<a.length;e++)if("main_page"===a[e].toLowerCase())mainPage.hide(),formPage.css("display","block"),o=formPage.closest(".form"),n=o.prop("classList");else{openModalForm(),Scrollmodal();for(let e=0;e<l.length;e++)"modal-lg"===l[e]?Largemodal():"modal-sm"===l[e]&&Smallmodal();o=modalForm.closest(".form"),n=o.prop("classList")}const i=o.find("input, textarea, select");let s=SITE_URL+SHOW+ID;setSave="update",$.getJSON({url:s,type:"GET",dataType:"JSON",success:function(e){for(let t=0;t<e.length;t++){let a=e[t].field,l=e[t].label;for(let e=0;e<n.length;e++)"show"===n[e].toLowerCase()&&"title"===a?modalTitle.html(capitalize(l)):"title"===a&&cardTitle.html(capitalize(l));for(let e=0;e<i.length;e++)if(i[e].name===a){let t=i[e].className.split(/\s+/)[1];o.find("input:text[name="+i[e].name+"], textarea[name="+i[e].name+"]").val(l),o.find("select[name="+i[e].name+"]").val(l).change(),"checkbox"===i[e].type&&"Y"===l?(o.find("input:checkbox[name="+i[e].name+"]").prop("checked",!0),"active"===t&&readonly(o,!1)):(o.find("input:checkbox[name="+i[e].name+"]").removeAttr("checked"),"active"===t&&readonly(o,!0))}}}})}),$(document).on("click",".x_form, .close_form",function(e){const t=$(e.target);let a;if("modal"!==t.attr("data-dismiss")){a=t.closest(".row");const e=a.find(".card").prop("classList");for(let t=0;t<e.length;t++)"form_page"===e[t].toLowerCase()&&(mainPage.show(),formPage.css("display","none"))}else a=t.closest(".form");const l=a.find("form");clearForm(l)}),$(".active").change(function(e){const t=$(e.target).closest(".form_open"),a=t.find("input, textarea, select");if($(this).is(":checked"))for(let e=0;e<a.length;e++){let l=a[e].className.split(/\s+/)[1];t.find("input:text[name="+a[e].name+"], textarea[name="+a[e].name+"]").removeAttr("readonly"),"text"!==a[e].type&&"active"!==l&&t.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").removeAttr("disabled")}else for(let e=0;e<a.length;e++){let l=a[e].className.split(/\s+/)[1];t.find("input:text[name="+a[e].name+"], textarea[name="+a[e].name+"]").prop("readonly",!0),"text"!==a[e].type&&"active"!==l&&t.find("input:checkbox[name="+a[e].name+"], select[name="+a[e].name+"]").prop("disabled",!0)}});const capitalize=e=>"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1);$(document).ready(function(e){$(".select2").select2({placeholder:"Select an option",width:"100%"}),$(".number").on("keypress keyup blur",function(e){$(this).val($(this).val().replace(/[^\d].+/,"")),(e.which<48||e.which>57)&&e.preventDefault()}),Toast=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:4e3})});